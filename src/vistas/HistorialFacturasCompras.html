<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Inventarios - Historial de Cambios</title>
    <link rel="stylesheet" href="../disenos/HistorialFacturasCompras.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
    <!-- Fondo animado -->
    <div class="background">
        <div class="shape shape1"></div>
        <div class="shape shape2"></div>
        <div class="shape shape3"></div>
        <div class="shape shape4"></div>
    </div>
    
    <!-- Header de navegación -->
    <header class="header">
        <div class="header-content">
            <div class="header-left">
                <div class="header-title">
                    <i class="fas fa-history"></i>
                    <h1>Historial de Cambios</h1>
                </div>
            </div>
            <div class="header-right">
                <div class="user-info" id="userInfo">
                    <i class="fas fa-user-circle"></i>
                    <span id="userName">Usuario</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Contenedor principal -->
    <div class="main-container">
        <!-- Panel de filtros compacto -->
        <div class="filters-panel-compact">
            <div class="filters-header">
                <div class="filters-title">
                    <i class="fas fa-filter"></i>
                    <span>Filtros de Búsqueda</span>
                </div>
                <div class="stats-summary">
                    <span class="total-changes">Total: <strong id="totalChanges">0</strong></span>
                </div>
            </div>
            
            <form id="filtersForm" class="filters-form-inline">
                <div class="filters-grid">
                    <!-- Fecha desde -->
                    <div class="filter-item">
                        <label for="fechaDesde">Fecha Desde</label>
                        <input type="date" id="fechaDesde" name="fechaDesde" required>
                    </div>
                    
                    <!-- Fecha hasta -->
                    <div class="filter-item">
                        <label for="fechaHasta">Fecha Hasta</label>
                        <input type="date" id="fechaHasta" name="fechaHasta" required>
                    </div>
                    
                    <!-- Serie de factura -->
                    <div class="filter-item">
                        <label for="serieFactura">Serie Factura</label>
                        <input type="text" id="serieFactura" name="serieFactura" placeholder="Ej: A001" maxlength="10">
                    </div>
                    
                    <!-- Número de factura -->
                    <div class="filter-item">
                        <label for="numeroFactura">Número Factura</label>
                        <input type="text" id="numeroFactura" name="numeroFactura" placeholder="Ej: 123456" maxlength="20">
                    </div>
                    
                    <!-- Tipo de cambio -->
                    <div class="filter-item">
                        <label for="tipoCambio">Tipo de Cambio</label>
                        <select id="tipoCambio" name="tipoCambio">
                            <option value="">Todos los tipos</option>
                            <option value="1">Serie</option>
                            <option value="2">Número</option>
                            <option value="3">Razón Social</option>
                            <option value="4">Monto Facturado</option>
                            <option value="5">Fecha Factura</option>
                            <option value="6">Proveedor</option>
                        </select>
                    </div>
                    
                    <!-- Motivo de modificación -->
                    <div class="filter-item">
                        <label for="tipoModificacion">Motivo</label>
                        <select id="tipoModificacion" name="tipoModificacion">
                            <option value="">Todos</option>
                            <option value="1">Modificación</option>
                            <option value="2">Refacturación</option>
                        </select>
                    </div>

                    <!-- Razón de modificación -->
                    <div class="filter-item">
                        <label for="razonModificacion">Razón</label>
                        <select id="razonModificacion" name="razonModificacion" disabled>
                            <option value="">Seleccione motivo</option>
                        </select>
                    </div>
                    
                    <!-- Botones -->
                    <div class="filter-actions">
                        <button type="button" class="btn-clear" id="limpiarFiltros" title="Limpiar filtros">
                            <i class="fas fa-eraser"></i>
                        </button>
                        <button type="submit" class="btn-search" title="Buscar cambios">
                            <span class="search-text">Buscar</span>
                            <span class="search-icon">
                                <i class="fas fa-search"></i>
                            </span>
                        </button>
                    </div>
                </div>
            </form>
        </div>

        <!-- Contenedor de resultados que ocupa toda la pantalla -->
        <div class="results-container" id="resultsContainer">
            <!-- Header de resultados -->
            <div class="results-header" id="resultsHeader" style="display: none;">
                <div class="results-info">
                    <div class="results-count">
                        <span id="resultsCount">0</span> cambios encontrados
                    </div>
                    <div class="results-period" id="resultsPeriod"></div>
                </div>
                <div class="table-controls">
                    <div class="export-actions">
                        <button class="btn-export" id="exportExcel" title="Exportar a Excel">
                            <i class="fas fa-file-excel"></i>
                            Exportar Excel
                        </button>
                    </div>
                    <button class="btn-new-search" id="nuevaBusqueda" title="Nueva búsqueda">
                        <i class="fas fa-search-plus"></i>
                        Nueva Búsqueda
                    </button>
                </div>
            </div>
            
            <!-- Tabla de resultados expandida -->
            <div class="table-container-full">
                <div class="table-wrapper-full">
                    <table class="changes-table-full" id="changesTable">
                        <thead>
                            <tr>
                                <th class="col-tipo">
                                    <i class="fas fa-tag"></i>
                                    <span>Tipo de Cambio</span>
                                </th>
                                <th class="col-anterior">
                                    <i class="fas fa-arrow-left"></i>
                                    <span>Valor Anterior</span>
                                </th>
                                <th class="col-nuevo">
                                    <i class="fas fa-arrow-right"></i>
                                    <span>Valor Nuevo</span>
                                </th>
                                <th class="col-inventario">
                                    <i class="fas fa-boxes"></i>
                                    <span>ID Inventario</span>
                                </th>
                                <th class="col-factura">
                                    <i class="fas fa-file-invoice"></i>
                                    <span>Factura</span>
                                </th>
                                <th class="col-monto">
                                    <i class="fas fa-dollar-sign"></i>
                                    <span>Monto</span>
                                </th>
                                <th class="col-sucursal">
                                    <i class="fas fa-building"></i>
                                    <span>Sucursal</span>
                                </th>
                                <th class="col-usuario">
                                    <i class="fas fa-user"></i>
                                    <span>Usuario</span>
                                </th>
                                <th class="col-fecha">
                                    <i class="fas fa-calendar"></i>
                                    <span>Fecha y Hora</span>
                                </th>
                                <th class="col-motivo">
                                    <i class="fas fa-cog"></i>
                                    <span>Motivo/Razón</span>
                                </th>
                                <th class="col-refacturacion">
                                    <i class="fas fa-redo"></i>
                                    <span>Refacturación</span>
                                </th>
                            </tr>
                        </thead>
                        <tbody id="changesTableBody">
                            <!-- Los datos se cargarán dinámicamente aquí -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Loading state -->
                <div class="table-loading" id="tableLoading" style="display: none;">
                    <div class="loading-content">
                        <div class="loading-spinner"></div>
                        <p>Cargando datos del historial...</p>
                    </div>
                </div>
                
                <!-- Empty state -->
                <div class="table-empty" id="tableEmpty" style="display: none;">
                    <div class="empty-content">
                        <div class="empty-icon">
                            <i class="fas fa-search-minus"></i>
                        </div>
                        <h3>No se encontraron cambios</h3>
                        <p>No hay cambios registrados en el período seleccionado</p>
                        <button class="btn-primary" onclick="document.getElementById('fechaDesde').focus()">
                            <i class="fas fa-calendar-alt"></i>
                            Cambiar Fechas
                        </button>
                    </div>
                </div>
                
                <!-- Welcome state -->
                <div class="welcome-state" id="welcomeState">
                    <div class="welcome-content">
                        <div class="welcome-icon">
                            <i class="fas fa-history"></i>
                        </div>
                        <h2>Historial de Cambios en Facturas</h2>
                        <p>Seleccione un rango de fechas para consultar el historial de modificaciones</p>
                        <div class="welcome-features">
                            <div class="feature-item">
                                <i class="fas fa-search"></i>
                                <span>Búsqueda avanzada con múltiples filtros</span>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-table"></i>
                                <span>Vista completa de toda la información</span>
                            </div>
                            <div class="feature-item">
                                <i class="fas fa-sort"></i>
                                <span>Ordenamiento y paginación inteligente</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Paginación -->
            <div class="pagination-container" id="paginationContainer" style="display: none;">
                <div class="pagination-info">
                    <span>Mostrando <span id="showingFrom">1</span> - <span id="showingTo">25</span> de <span id="totalRecords">0</span> registros</span>
                </div>
                <div class="pagination-controls">
                    <button class="pagination-btn" id="firstPage" disabled title="Primera página">
                        <i class="fas fa-angle-double-left"></i>
                    </button>
                    <button class="pagination-btn" id="prevPage" disabled title="Página anterior">
                        <i class="fas fa-angle-left"></i>
                    </button>
                    <div class="pagination-pages" id="paginationPages">
                        <!-- Se generarán dinámicamente -->
                    </div>
                    <button class="pagination-btn" id="nextPage" title="Página siguiente">
                        <i class="fas fa-angle-right"></i>
                    </button>
                    <button class="pagination-btn" id="lastPage" title="Última página">
                        <i class="fas fa-angle-double-right"></i>
                    </button>
                </div>
                <div class="pagination-size">
                    <label for="pageSize">Mostrar:</label>
                    <select id="pageSize">
                        <option value="10">10</option>
                        <option value="25" selected>25</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                        <option value="200">200</option>
                    </select>
                    <span>registros</span>
                </div>
            </div>
        </div>
    </div>

    <script src="../logica/HistorialFacturasCompras.js"></script>
</body>
</html>